# re-oil-production-llm

![image](https://github.com/user-attachments/assets/6883733b-126d-4529-9cd6-850a5e500a20)

## Оптимизация добычи нефти с использованием LLM

Данный проект исследует применение больших языковых моделей (LLM) для оптимизации стратегий добычи нефти. Мы используем методы обучения с подкреплением, в частности GRPO, для обучения языковых моделей принимать оптимальные решения по управлению нефтяными скважинами.

## Обзор проекта

Оптимизация добычи нефти требует нахождения баланса между немедленными темпами добычи и долгосрочным управлением резервуаром. Этот проект реализует:

- Среду симуляции нефтяных скважин (пока одиночной)
- Фреймворк обучения на основе GRPO для дообучения языковых моделей
- Методы инженерии промптов для направления ответов LLM
- Методы оценки производительности оптимизации

Обученные модели учатся управлять степенью открытия штуцера (от 0 до 1) для максимизации общей добычи нефти на протяжении всего периода симуляции.

## Возможности

- **Симуляция одиночной скважины**: Моделирование как изолированных, так и взаимосвязанных систем скважин
- **Обучение с использованием GRPO**: Эффективная оптимизация политики для LLM
- **Инженерия промптов**: Структурированные форматы ввода для последовательных и эффективных ответов LLM
- **Интеграция с WandB и TensorBoard**: Всестороннее отслеживание и визуализация экспериментов
- **Поддержка квантизации**: 4-битная и 8-битная квантизация для эффективного обучения моделей
- **Дообучение с LoRA**: Low-Rank Adaptation для эффективной настройки параметров

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/researchim-ai/re-oil-production-llm.git
cd re-oil-production-llm
```

2. Установите необходимые зависимости:
```bash
pip install -r requirements.txt
```

## Использование

Для запуска обучения на 4 дня:

```bash
python -m grpo.main --forecast_days 1 --simulation_max_time 4 --kl_weight 0.05 --lr 1e-5 --clip_eps 0.3 --gamma 0.99 --total_steps 1000 --rollouts_per_step 8 --train_batch_size 8 --temperature 0.7 --wandb

```

### Основные параметры

Скрипт поддерживает множество параметров для настройки процесса обучения:

```
--run_name               Пользовательское имя запуска для логирования
--log_dir                Корневой каталог для логов
--wandb                  Использовать WandB для логирования
--wandb_project          Имя проекта WandB
--seed                   Случайное зерно (по умолчанию: 42)
--device_index           Индекс устройства CUDA (по умолчанию: 0)
--model_name             Имя или путь к модели (по умолчанию: "Qwen/Qwen2.5-3B-Instruct")
--checkpoint_path        Путь для сохранения контрольных точек
--checkpoint_interval    Сохранять контрольную точку каждые N глобальных шагов
--total_steps            Общее количество шагов оптимизации
--rollouts_per_step      Количество эпизодов симуляции на глобальный шаг
--multi_well             Использовать симулятор нескольких скважин вместо одиночной
--initial_pressure       Начальное давление в резервуаре (атм)
--productivity_index     Индекс продуктивности (м3/день/атм)
--total_volume           Общий объем резервуара (м3)
--forecast_days          Количество дней для прогноза на каждом шаге

Поиск оптимальных параметров для одной скважины при заданных условиях:
```
python scripts/find_step_optimal_choke.py     --initial_pressure 200.0     --initial_bhp 50.0     --productivity_index 0.1     --total_volume 1e6     --simulation_dt 1.0     --forecast_days 1     --simulation_max_time 4     --num_action_steps 11     --output_file results/optimal_strategy_4days.json
```

## Текущее состояние

В настоящее время проект предоставляет полностью функциональные реализации сценариев оптимизации как для одной скважины, так и для нескольких скважин. Сценарий с одной скважиной служит более простой базовой линией и доказательством концепции, в то время как реализация с несколькими скважинами учитывает более сложную динамику резервуара с взаимодействием между скважинами.

## Конвейер

1. **Среда симуляции**: Система моделирует поведение нефтяных скважин, включая изменения давления, расходы и накопленную добычу.
2. **Взаимодействие с LLM**: Языковая модель получает текущее состояние и историю, а затем принимает решение об оптимальном открытии штуцера.
3. **Обучение с подкреплением**: Модель обучается на основе вознаграждений от результатов добычи нефти.
4. **Оценка**: Производительность обученной модели оценивается на расширенных периодах симуляции.

## Лицензия

Этот проект предоставляется как исследовательское программное обеспечение.

## Цитирование

Если вы используете этот проект в своем исследовании, пожалуйста, цитируйте:

```
@software{llm_oil_production,
  author = {Researchim},
  title = {LLM для оптимизации добычи нефти},
  year = {2025},
  url = {https://github.com/researchim-ai/re-oil-production-llm}
}
``` 